<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin – Allowed Codes</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Admin – Allowed Codes</h1>

  <section class="admin">
    <p>
      Enter the admin access code to view and edit the list of allowed user codes.
      These codes are what users type on the main calculator page.
    </p>

    <label>
      Admin access code:
      <input type="password" id="adminCodeInput" placeholder="Admin code">
    </label>
    <button id="btnAdminUnlock">Unlock</button>
    <p id="adminStatus"></p>

    <div id="adminPanel" style="display: none;">
      <h2>Allowed Codes</h2>
      <ul id="allowedList"></ul>

      <label>
        New allowed code:
        <input type="text" id="newAllowedCode" placeholder="e.g. bmoore">
      </label>
      <button id="btnAddAllowed">Add Code</button>

      <p class="small-note">
        Codes are stored locally in this browser under <code>allowedUserCodes</code>.
        Removing a code prevents that code from being used on the main page.
      </p>
    </div>
  </section>

  <script>
    // IMPORTANT: Change this to your own secret string after upload.
    const ADMIN_CODE = 'CHANGE_ME_ADMIN_CODE';

    let allowedUserCodes = [];

    document.addEventListener('DOMContentLoaded', () => {
      loadAllowedCodes();
      renderAllowedList();

      document.getElementById('btnAdminUnlock').addEventListener('click', unlockAdmin);
      document.getElementById('btnAddAllowed').addEventListener('click', addAllowedCode);
    });

    function loadAllowedCodes() {
      const raw = localStorage.getItem('allowedUserCodes');
      if (raw) {
        try {
          allowedUserCodes = JSON.parse(raw);
        } catch {
          allowedUserCodes = [];
        }
      } else {
        allowedUserCodes = [];
      }
    }

    function saveAllowedCodes() {
      localStorage.setItem('allowedUserCodes', JSON.stringify(allowedUserCodes));
    }

    function unlockAdmin() {
      const input = document.getElementById('adminCodeInput');
      const code = input.value.trim();
      const status = document.getElementById('adminStatus');
      const panel = document.getElementById('adminPanel');

      if (code === ADMIN_CODE) {
        status.textContent = 'Admin unlocked.';
        status.classList.remove('warning');
        panel.style.display = 'block';
        renderAllowedList();
      } else {
        status.textContent = 'Incorrect admin code.';
        status.classList.add('warning');
        panel.style.display = 'none';
      }
    }

    function renderAllowedList() {
      const ul = document.getElementById('allowedList');
      if (!ul) return;

      ul.innerHTML = '';

      if (!allowedUserCodes.length) {
        const li = document.createElement('li');
        li.textContent = '(no codes yet)';
        ul.appendChild(li);
        return;
      }

      allowedUserCodes.forEach(code => {
        const li = document.createElement('li');
        li.textContent = code;

        const btn = document.createElement('button');
        btn.textContent = 'X';
        btn.title = 'Remove code';
        btn.addEventListener('click', () => removeAllowedCode(code));

        li.appendChild(btn);
        ul.appendChild(li);
      });
    }

    function addAllowedCode() {
      const input = document.getElementById('newAllowedCode');
      const code = input.value.trim();
      if (!code) {
        alert('Enter a code to add.');
        return;
      }

      if (allowedUserCodes.includes(code)) {
        alert('That code is already allowed.');
        return;
      }

      allowedUserCodes.push(code);
      saveAllowedCodes();
      renderAllowedList();
      input.value = '';
    }

    function removeAllowedCode(code) {
      if (!confirm(`Remove code "${code}"?`)) return;
      allowedUserCodes = allowedUserCodes.filter(c => c !== code);
      saveAllowedCodes();
      renderAllowedList();
    }
  </script>
</body>
</html>
